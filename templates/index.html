<html>
    <head>
        <title>Parkinson's Gene Expression Analysis</title>
        <style>
            body {
                font-family: Arial, sans-serif;
                max-width: 800px;
                margin: 50px auto;
                padding: 20px;
            }
            h1 {
                color: #333;
            }
            .autocomplete {
                position: relative;
                display: inline-block;
                width: 100%;
            }
            input[type="text"] {
                width: 100%;
                padding: 10px;
                font-size: 16px;
                border: 2px solid #ddd;
                border-radius: 4px;
                box-sizing: border-box;
            }
            .autocomplete-items {
                position: absolute;
                border: 1px solid #d4d4d4;
                border-top: none;
                z-index: 99;
                top: 100%;
                left: 0;
                right: 0;
                max-height: 300px;
                overflow-y: auto;
                background-color: white;
            }
            .autocomplete-items div {
                padding: 10px;
                cursor: pointer;
                background-color: #fff;
                border-bottom: 1px solid #d4d4d4;
            }
            .autocomplete-items div:hover {
                background-color: #e9e9e9;
            }
            input[type="submit"] {
                background-color: #4CAF50;
                color: white;
                padding: 12px 30px;
                font-size: 16px;
                border: none;
                border-radius: 4px;
                cursor: pointer;
                margin-top: 10px;
            }
            input[type="submit"]:hover {
                background-color: #45a049;
            }
            .umap-button {
                display: inline-block;
                background-color: #2196F3;
                color: white;
                padding: 12px 30px;
                font-size: 16px;
                text-decoration: none;
                border-radius: 4px;
                cursor: pointer;
                margin-top: 10px;
                transition: background-color 0.3s;
            }
            .umap-button:hover {
                background-color: #0b7dda;
            }
            .row {
                display: flex;
                align-items: center;
                justify-content: space-between;
                gap: 20px;
            }
            .column {
                display: flex;
                align-items: center;
            }

        </style>
    </head>
    <body>
        <div class="row">
            <div class="column">
                <h1>Parkinson's Gene Expression Analysis</h1>
            </div>
            <div class="column">
                <img src="/static/brain.png" alt="brain" style="width: 100px; height: auto;">
            </div>
        </div>
        
        <p>Enter a gene name to analyze its expression across different tissues:</p>
        <form action="/analyze" method="POST">
            <div class="autocomplete">
                <input type="text" id="geneInput" name="gene" placeholder="Type gene name (e.g., TSPAN6)" required>
                <div id="autocomplete-list" class="autocomplete-items"></div>
            </div>
            <br>
            <input type="submit" value="Analyze Gene Expression">
        </form>
        
        <div style="margin-top: 40px; padding-top: 30px; border-top: 2px solid #ddd;">
            <h2 style="color: #333;">Explore the Dataset</h2>
            <p>View an interactive UMAP visualization of all samples colored by tissue type:</p>
            <a href="/umap" class="umap-button">
                View UMAP Visualization
            </a>
            <a href="/tissue_genes" class="umap-button" style="background-color:#6f42c1; margin-left:10px;">
                Tissue Top/Bottom Genes
            </a>
        </div>

        <script>
            const input = document.getElementById('geneInput');
            const autocompleteList = document.getElementById('autocomplete-list');
            let currentFocus = -1;

            input.addEventListener('input', async function(e) {
                const val = this.value;
                closeAllLists();
                if (!val) { return false; }
                currentFocus = -1;

                try {
                    const response = await fetch(`/get_genes?q=${encodeURIComponent(val)}`);
                    const genes = await response.json();

                    genes.forEach(gene => {
                        const div = document.createElement('div');
                        const matchIndex = gene.toLowerCase().indexOf(val.toLowerCase());
                        if (matchIndex !== -1) {
                            div.innerHTML = gene.substr(0, matchIndex) + 
                                          '<strong>' + gene.substr(matchIndex, val.length) + '</strong>' +
                                          gene.substr(matchIndex + val.length);
                        } else {
                            div.innerHTML = gene;
                        }
                        div.addEventListener('click', function(e) {
                            input.value = gene;
                            closeAllLists();
                        });
                        autocompleteList.appendChild(div);
                    });
                } catch (error) {
                    console.error('Error fetching genes:', error);
                }
            });

            input.addEventListener('keydown', function(e) {
                let x = autocompleteList.getElementsByTagName('div');
                if (e.keyCode == 40) { // Down arrow
                    currentFocus++;
                    addActive(x);
                } else if (e.keyCode == 38) { // Up arrow
                    currentFocus--;
                    addActive(x);
                } else if (e.keyCode == 13) { // Enter
                    e.preventDefault();
                    if (currentFocus > -1) {
                        if (x) x[currentFocus].click();
                    }
                }
            });

            function addActive(x) {
                if (!x) return false;
                removeActive(x);
                if (currentFocus >= x.length) currentFocus = 0;
                if (currentFocus < 0) currentFocus = (x.length - 1);
                x[currentFocus].classList.add('autocomplete-active');
            }

            function removeActive(x) {
                for (let i = 0; i < x.length; i++) {
                    x[i].classList.remove('autocomplete-active');
                }
            }

            function closeAllLists() {
                autocompleteList.innerHTML = '';
            }

            document.addEventListener('click', function (e) {
                if (e.target !== input) {
                    closeAllLists();
                }
            });
        </script>
    </body>
</html>